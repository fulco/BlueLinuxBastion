# Blue Linux Bastion: Linux System Hardening Scripts

This repository contains a set of scripts designed to enhance the security of Linux systems. These scripts are designed for blue teams during security competitions or for anyone looking to implement stringent security measures on their Linux systems. They are designed for my personal needs and may not meet your own. 

![Image of the Bastion](https://github.com/fulco/BlueLinuxBastion/assets/802660/52bd88c5-a985-4ed2-af29-9698733b0198)

## Scripts Overview

### userkiller.sh

This script is the main hardening script that performs the following tasks:
- Logs out all users (except the specified user and root) and kills their processes
- Clears cron jobs for all users (except the specified user and root)
- Changes passwords for all users (except the specified user and root)
- Updates the SSH daemon (sshd) to listen on a custom port (defined by `$NEW_SSH_PORT`)
- Configures firewall rules using UFW (Uncomplicated Firewall) or iptables based on a specified input file
- Creates a backup admin user with sudo access for emergency purposes
- Logs script actions to a file for future reference and troubleshooting
- Generates the `croncheck.sh` script and `cronline.txt` file for periodic system checks
- Manages system services by displaying enabled and running services and allowing the user to selectively disable non-needed services

### croncheck.sh

This script is generated by the `userkiller.sh` script and is designed to be run periodically via cron to ensure that the system remains hardened. It performs the following checks:
- Verifies that the backup admin user exists and has sudo access
- Checks if the SSH configuration file is unchanged and has the immutable flag set
- Checks if the firewall rules are unchanged based on the defined rules (port specified by `$NEW_SSH_PORT`)

### cronline.txt

This file is generated by the `userkiller.sh` script and contains a sample cron entry to run the `croncheck.sh` script periodically and log any failures to the `/var/log/croncheck_failure.log` file.

### conchecker.sh

The `conchecker.sh` script is a new addition that monitors network connections on the Linux system and identifies unauthorized connections. It performs the following tasks:
- Retrieves the current user's SSH connection IP and excludes it from the checks
- Parses the output of `netstat -antp` to extract connection details
- Checks if each connection is allowed based on the `allowed_ips.txt` file
- If a connection is unauthorized:
  - Prompts the user to kill the associated process
  - Prompts the user to add a firewall rule to block the connection
- Logs detailed information about the script's actions with timestamps

## Usage, Prerequisites, Configuration, and More

For detailed information on how to use these scripts, including prerequisites, configuration, troubleshooting, and more, please refer to the [Blue Linux Bastion Wiki](https://github.com/fulco/BlueLinuxBastion/wiki).

## Contributing

Contributions are welcome to enhance the scripts' functionality or documentation. Please fork the repository, make your changes, and submit a pull request for review.

## License

This project is released under the [MIT License](https://opensource.org/licenses/MIT).

## Disclaimer

These scripts are provided as-is and should be used with caution. It is recommended to test the scripts in a non-production environment before applying them to critical systems. The scripts make significant changes to user accounts, processes, and system configurations, so ensure that you have appropriate backups and understand the implications of running the scripts.