# Blue Linux Bastion: Linux System Hardening Scripts

This repository contains a set of scripts designed to enhance the security of Linux systems. These scripts are designed for blue teams during security competitions or for anyone looking to implement stringent security measures on their Linux systems. They are designed for my personal needs and may not meet your own. 

![Image of the Bastion](https://github.com/fulco/BlueLinuxBastion/assets/802660/52bd88c5-a985-4ed2-af29-9698733b0198)

## Scripts Overview

### userkiller.sh

This script is the main hardening script that performs the following tasks:
- Logs out all users (except the specified user and root) and kills their processes
- Clears cron jobs for all users (except the specified user and root)
- Changes passwords for all users (except the specified user and root)
- Updates the SSH daemon (sshd) to listen on a custom port (defined by `$NEW_SSH_PORT`)
- Configures firewall rules using UFW (Uncomplicated Firewall) or iptables based on a specified input file
- Creates a backup admin user with sudo access for emergency purposes
- Logs script actions to a file for future reference and troubleshooting
- Generates the `croncheck.sh` script and `cronline.txt` file for periodic system checks

### croncheck.sh

This script is generated by the `userkiller.sh` script and is designed to be run periodically via cron to ensure that the system remains hardened. It performs the following checks:
- Verifies that the backup admin user exists and has sudo access
- Checks if the SSH configuration file is unchanged and has the immutable flag set
- Checks if the firewall rules are unchanged based on the defined rules (port specified by `$NEW_SSH_PORT`)

### cronline.txt

This file is generated by the `userkiller.sh` script and contains a sample cron entry to run the `croncheck.sh` script periodically and log any failures to the `/var/log/croncheck_failure.log` file.


## Usage

1. Clone the repository or download the script file.
   ```bash
   git clone https://github.com/fulco/BlueLinuxBastion.git
   ```
   ```bash
   wget --no-check-certificate https://raw.githubusercontent.com/fulco/BlueLinuxBastion/main/userkiller.sh
   ```
2. Make the `userkiller.sh` script executable using the command:
   ```bash
   chmod +x userkiller.sh
   ```
3. Run the `userkiller.sh` script with root privileges and provide the username to exclude as an argument:
   ```
   sudo ./userkiller.sh <username_to_exclude>
   ```
4. Enter the new password for the users when prompted.
5. The script will perform the hardening tasks, generate the `croncheck.sh` script and `cronline.txt` file, and display relevant information.
6. Review the generated `cronline.txt` file and add the cron entry to your system's crontab to run the `croncheck.sh` script periodically.

## Prerequisites

- The scripts must be run with root privileges.
- The system should have either UFW or iptables installed for configuring firewall rules.
- An input file (`allowed_ips.txt`) should be created, containing the allowed IP addresses and ports for SSH access.
   
## Configuration

- The `allowed_ips.txt` file should contain the allowed IP addresses and ports for remote access in the following format:
   ```
   192.168.1.23 8080
   192.168.1.45 22
   ```
- The `userkiller.sh` script sets the SSH port using the `$NEW_SSH_PORT` variable. By default, it is set to 2298. If needed, you can modify the value of `$NEW_SSH_PORT` in the script.
- The `userkiller.sh` script logs its actions to the `/var/log/userkiller.log` file. You can change the log file path by modifying the `exec` command at the beginning of the script.

## Password Complexity

It is recommended to enforce strong password complexity requirements when setting new passwords for users. The `userkiller.sh` script prompts for a new password and verifies that it is at least 8 characters long. You can modify the password complexity requirements in the `setup_passwords()` function as needed.

## Logging

The `userkiller.sh` script logs its actions to the `/var/log/userkiller.log` file. Each log entry includes a timestamp to track when each action was performed. You can review this log file for troubleshooting and auditing purposes.

The `croncheck.sh` script logs any failures to the `/var/log/croncheck_failure.log` file, as specified in the `cronline.txt` file. Each failure entry includes a timestamp and an indication that the script execution failed.

## Disclaimer

These scripts are provided as-is and should be used with caution. It is recommended to test the scripts in a non-production environment before applying them to critical systems. The scripts make significant changes to user accounts, processes, and system configurations, so ensure that you have appropriate backups and understand the implications of running the scripts.

## License

This project is released under the [MIT License](https://opensource.org/licenses/MIT).